# 低かぶり複数回グルーピングツール「バラすくん」

グループ分けを複数回やるときになるべく同じ人とかぶらないように振り分けるやつです。

## 概要

P人の参加者をG個のグループにほぼ均等に分ける。
1回目（n回目,n=1）はランダムに分ける。
2回目以降はなるべく同じ人が被らないようにグループ分けする。

## 仕様

参加者は名前（文字列）で表される。
- 例：```のこのこ＠おはよう```
- 例：```天下一太郎```

グループ名は、A-Z のアルファベット1文字で表す。
最大26グループとする。

履歴を表す記法は ```#{n:n回目}{g:グループ(A-Z)のどれか}``` である。
- ```#1A``` は 1回目にグループAに振り分けれらたことを意味する。
- ```#1A#2B#3C#4A``` は1回目はグループA、2回目はグループB、3回目はグループC、4回目はグループA、に振り分けられたことを意味する。

参加者の名前に履歴を繋げたものを基本データとして扱う。
初回は履歴は空であることに留意。
- 例：```天下一太郎```（初回）
- 例：```天下一太郎#1A#2B#3C```

評価指標:
- またかよ数(MK)
  - ある参加者が、過去に同じグループになったことがある人と、何回一緒だったかの合計
  - つまり、「またこの人と同じグループかよ！」と思う回数の合計
- またかよ平均(MA)
  - グループ内の全メンバーの「またかよ数」の平均

ロジック:
- Step0→Step1
  - P人をランダムにG個のグループに振り分ける
- Step(n)→Step(n+1): (n > 0)
  - P人を所属グループでソートしたリストを作る
  - G個のグループのそれぞれを空にする
  - loop: P人を「所属グループでソートしたリスト」から順番に一人ずつ(変数p)
    - G個のグループのうち0人のグループgがあれば
      - グループgにpを割り振る→next
    - G個のグループのうちメンバー数最小のグループたちに対してpのまたかよ数を計算（履歴を用いる）
      - その値が最小となるグループgを得る
      - グループgにpを割り振る


## 実行例

P=11,G=3

```
(Step0) 入力1：
Cat
Lion
Pig
Fox
Tiger
Duck
Wolf
Cow
Bear
Dog
Owl

(Step1) 出力1（グループ分け1回目）＆入力2：
Dog#1A
Cat#1A
Pig#1A
Fox#1A
Cow#1B
Duck#1B
Lion#1B
Wolf#1B
Bear#1C
Owl#1C
Tiger#1C

(Step2) 出力2（グループ分け2回目）＆入力3：
Dog#1A#2A
Fox#1A#2A
Lion#1B#2A
Owl#1C#2A
Cat#1A#2B
Cow#1B#2B
Wolf#1B#2B
Tiger#1C#2B
Pig#1A#2C
Duck#1B#2C
Bear#1C#2C

(Step3) 出力3（グループ分け3回目）
Dog#1A#2A#3A
Owl#1C#2A#3A
Wolf#1B#2B#3A
Duck#1B#2C#3A
Fox#1A#2A#3B
Cat#1A#2B#3B
Tiger#1C#2B#3B
Bear#1C#2C#3B
Lion#1B#2A#3C
Cow#1B#2B#3C
Pig#1A#2C#3C
```

## UI

プログラムは javascript で書く。
HTMLファイルに内包される javascript プログラム。
完成品は1つのHTMLファイルとなる。
プログラムにはこの仕様書から引用したコメントを入れる。

参加者はフォームで入力する。
「グループ分け実行」ボタンでグループ分けを行う。
グループ分け結果（参加者の後ろに履歴文字列がつく）は入力フォームに上書きされる

参加者の人数を表示するエリアあり。
グループ分けの際のグループ数を指定・表示するフォームあり。

グループ表示用フォームにグループごとの参加者情報を表示。
グループ分け結果の末尾履歴に基づいて、グループごとに参加者を一行にまとめて表示する。
例えば、下記のグループ分け結果を処理すると
```
Dog#1A#2A#3A
Owl#1C#2A#3A
Wolf#1B#2B#3A
Duck#1B#2C#3A
Fox#1A#2A#3B
Cat#1A#2B#3B
Tiger#1C#2B#3B
Bear#1C#2C#3B
Lion#1B#2A#3C
Cow#1B#2B#3C
Pig#1A#2C#3C
```
このようになる：
```
A Dog Owl Wolf Duck
B Fox Cat Tiger Bear
C Lion Cow Pig
```

ページの一番下に統計情報表示用フォームに統計情報を表示。
各参加者のまたかよ数(MK)と
各グループのまたかよ平均(MA)を
テキスト形式で表示する。
ここで表示するMK,MAは「今回のグループ」は計算対象としないことに留意。
末尾の履歴を無視して計算する。

最初に入力フォームに参加者サンプルを表示する。
参加者数も自動カウントする。

スマホからも使えるようにする。

グループ表示用フォームに機能追加。
グループ名(A-Z)を表示・非表示をチェックボックスで切り替え。
セパレータ文字に現在のスペース(" ")以外に、カンマ(",")、ダブルスペース("  ")、タブ文字("\t")も選択できるようにする。
ワンクリックでコピーできる「コピー」ボタンも用意する。

参加者更新フィルター機能。

参加者入力フォームの参加者リストに対して次の処理を行う。
(1) 履歴抜きで名前だけで重複を確認し、重複があれば履歴あり（名前＋履歴）を残す。
(2) 重複のなかった名前で履歴ありの場合は削除。
(3) 重複のなかった名前で履歴なしの場合は残す（名前＋空の履歴）。
これらの処理を行い結果を参加者入力フォームに上書きする「参加者更新」ボタンを用意する。
参加者更新フィルターは強力なので、参加者リストに履歴なしの参加者がいない場合は動かないようにする。
例：
```
input:
Owl#1A
Lion#1A
Pig#1A
Cow#1A
Cat#1B
Lion
Pig
Cow
Fox
Dog

output:
Lion#1A
Pig#1A
Cow#1A
Fox
Dog
```

参加者リストの変更記録機能。
参加者リストフォームの中のテキストが変更されるたびに配列変数にテキスト内容を記憶しておく。
「1ステップ戻る」ボタンで1ステップ前のテキストでフォームを上書きする（あれば）。
「1ステップ進む」ボタンで1ステップ先のテキストでフォームを上書きする（あれば）。

