<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã‚‚ãã‚‚ããƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼</title>
  <link rel="manifest" href="/tools/pomo/manifest.json">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100%; overflow: hidden; }
    #container { display: grid; grid-template-columns: auto 5px auto; grid-template-rows: auto; height: 100vh; }
    .splitter-vertical { background: #f8f8f8; cursor: col-resize; width: 5px; z-index: 10; }
    .splitter-horizontal { background: #f8f8f8; cursor: row-resize; height: 5px; width: 100%; z-index: 1000; }
    /* è‡ªç”±è¨˜è¿°ã‚¨ãƒªã‚¢ */
    #freePane { position: relative; overflow: auto; padding: 10px; }
    #editableContent { min-height: 100%; padding: 5px; }
    #editableContent:focus { outline: none; }
    #editableContent img.selected { outline: 2px solid blue; }
    #toolbar {
        display: none;
        position: absolute;
        bottom: 10px; left: 10px; right: 10px;
        background: #f0f0f0;
        border: 1px solid #999;
        padding: 5px;
        flex-wrap: wrap; gap: 2px;
        align-items: center;
        z-index: 20;
        user-select: none;
    }
    #toolbar button {
        padding: 0px 5px;
    }
    /* å³å´ */
    #rightGrid { display: grid; grid-template-rows: auto 5px auto; grid-template-columns: 1fr; height: 100%; }
    /* YouTubeã‚¨ãƒªã‚¢ */
    #youtubeArea, #timerArea {
        border-bottom: none;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        /* ãƒ•ã‚©ãƒ³ãƒˆã‚’å‹•çš„ã«èª¿æ•´ã™ã‚‹ã®ã§ã€transform ã¯ä½¿ç”¨ã—ãªã„ */
    }
    #youtubeArea {
        margin: 0;
        padding: 0;
    }
    #videoForms {
        position: absolute;
        bottom: 60px;
        right: 10px;
        background-color: rgba(255, 255, 255, 0.7);
        border: 1px solid #888;
        border-radius: 10px;
        display: none;
        font-size: small;
        z-index: 10;
    }
    #youtubeArea:hover #videoForms {
        display: block;
    }
    #videoForms form {
        margin: 5px;
    }
    #videoFrame {
        display: block;
        width: 100%;
        border: none;
    }

    /* ã‚¿ã‚¤ãƒãƒ¼ã‚¨ãƒªã‚¢ */
    #timerArea {
	border-bottom: none;
	display: flex;
	flex-direction: column;
	align-items: center;
	justify-content: center;
	position: relative;
        color: #333;
	accent-color: #555;
    }
    #modeLabel { margin-bottom: 5px; }
    #timerDisplay { margin-bottom: 10px; font-weight: bold; color: #aaa; }
    #timerSlider { width: 80%; margin-bottom: 10px; }
    #timerArea.work {
        /* background-color: #FFF5E5; ã‚ªãƒ¬ãƒ³ã‚¸ç³»ã®è–„ã„èƒŒæ™¯ */
        background-color: #FFFFFF;
        color: #333;
    }
    #timerArea.break {
        background-color: #E6FFEA; /* ãƒŸãƒ³ãƒˆã‚°ãƒªãƒ¼ãƒ³ç³»ã®è–„ã„èƒŒæ™¯ */
	color: #333;
    }
    .volumeControl {
	position: absolute;
	bottom: 10px;
	left: 50%;
	transform: translateX(-50%);;
	display: none;
	gap: 4px;
	margin-top: 8px;
	accent-color: #555;
    }
    #timerArea:hover .volumeControl {
	display: block;
    }

    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã®æœ«å°¾ã‚ãŸã‚Šã«è¿½åŠ  */
    #resetBtn {
	position: fixed;
	bottom: 10px;
	right: 10px;
	padding: 5px 10px;
	background: rgba(255,255,255,0.8);
	border: 1px solid #888;
	border-radius: 4px;
	font-size: small;
	cursor: pointer;
	display: none;             /* é€šå¸¸ã¯éš ã™ */
	z-index: 100;
    }
    #resetBtn:hover {
	background: rgba(255,255,255,1);
    }
  </style>
</head>
<body>
<div id="container">
  <div id="freePane">
    <div id="editableContent" title="ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†é–‹å§‹">
      <p style="text-align: center;"><span style="font-weight: bold; font-size: xxx-large;">ã‚µãƒ³ãƒ—ãƒ«ã‚‚ãã‚‚ãä¼š</span></p><p style="text-align: center;"><span style="font-weight: bold;"></span></p><p style="text-align: center;"><span style="font-weight: bold;">æ¯æ—¥00:00-23:59</span></p><p style="text-align: center;"><span style="font-weight: bold;">25åˆ† é›†ä¸­ä½œæ¥­ / 5åˆ† ä¼‘æ†©</span></p><p style="text-align: center;"></p>
      <p style="text-align: center;"><img src="https://live.staticflickr.com/65535/54368779670_cfbcaeb32d_z.jpg" class="" style="width: 262px;"></p>
      <p style="text-align: center;"><br></p>
      <p style="text-align: center;"><br></p><p style="text-align: center;"><span style="text-decoration-line: underline;">ã‚‚ãã‚‚ããƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼</span></p>
      <p style="text-align: center;"><img src="https://yapi.ta2o.net/tools/pomo/icons/icon-192.png" class="" style="width: 128px;"></p>
      <p style="text-align: center;">3ã¤ã®æƒ…å ±ã‚’åŒæ™‚ã«å‡ºã›ã‚‹ï¼</p><p style="text-align: center;">ç”»é¢å…±æœ‰ã«ä¾¿åˆ©ãªãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ï¼</p>
      <p style="text-align: center;"><br></p>
      <p style="text-align: center;">1. ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ï¼šä½œæ¥­æ™‚é–“ã¨ä¼‘æ†©æ™‚é–“ã‚’ç®¡ç†ã€‚æ™‚é–“é…åˆ†é¸ã¹ã‚‹</p>
      <p style="text-align: center;">2. YouTubeå‹•ç”»å†ç”Ÿï¼šä½œæ¥­æ™‚é–“ã¨ä¼‘æ†©æ™‚é–“ã«åˆ¥ã®å‹•ç”»ã‚’å†ç”Ÿã§ãã‚‹</p>
      <p style="text-align: center;">3. è‡ªç”±è¨˜è¿°æ¬„ï¼šãƒ†ã‚­ã‚¹ãƒˆã‚„å†™çœŸã€‚ã‚‚ãã‚‚ãä¼šã®è¶£æ—¨ã‚„ãŠçŸ¥ã‚‰ã›ãªã©</p>
      <p style="text-align: center;"><br></p>
      <p style="text-align: center;">ã“ã‚Œã‚‰3ã¤ã®æƒ…å ±ã‚’å‡ºã™ã‚¨ãƒªã‚¢ã®ã‚µã‚¤ã‚ºã®èª¿æ•´å¯èƒ½</p>
      <p style="text-align: center;">è¨­å®šé …ç›®ã¯è‡ªå‹•ä¿å­˜ã•ã‚Œã€åŒã˜ãƒ–ãƒ©ã‚¦ã‚¶ãªã‚‰ã°ç¶™ç¶šã—ã¦åˆ©ç”¨å¯èƒ½</p>
    </div>
    <div id="toolbar">
      <button data-cmd="bold" style="font-weight: bold">Bold</button>
      <button data-cmd="italic" style="font-style: italic;">Italic</button>
      <button data-cmd="underline" style="text-decoration: underline;">Underline</button>
      &nbsp;
      <button data-cmd="justifyLeft">Leftâ”„</button>
      <button data-cmd="justifyCenter">â”„Centerâ”„</button>
      <button data-cmd="justifyRight">â”„Right</button>
      &nbsp;
      <button data-cmd="removeFormat">æ–‡å­—è£…é£¾ã‚¯ãƒªã‚¢</button>
      &nbsp;
      <span>æ–‡å­—ã‚µã‚¤ã‚ºå¤‰æ›´</span>
      <select id="fontSizeSelect">
        <option value="1"></option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
      </select>
      &nbsp;
      <button id="imgZoomInBtn">ç”»åƒæ‹¡å¤§</button>
      <button id="imgZoomOutBtn">ç”»åƒç¸®å°</button>
      &nbsp;
      <button id="copyHtmlBtn">HTMLã‚³ãƒ”ãƒ¼</button>
      <button id="pasteHtmlBtn">HTMLãƒšãƒ¼ã‚¹ãƒˆ</button>
      &nbsp;
      <button id="closeToolbar">é–‰ã˜ã‚‹</button>
    </div>
  </div>
  <div class="splitter-vertical" id="splitV"></div>
  <div id="rightGrid">
    <div id="youtubeArea">
      <div id="videoForms">
        <form id="workVideoForm">
          ä½œæ¥­æ™‚å‹•ç”» <input type="text" id="workVideoURL" placeholder="YouTube URL" size="30">
	  <button type="submit">ç™»éŒ²</button>
        </form>
        <form id="breakVideoForm">
          ä¼‘æ†©æ™‚å‹•ç”» <input type="text" id="breakVideoURL" placeholder="YouTube URL" size="30">
	  <button type="submit">ç™»éŒ²</button>
        </form>
      </div>
      <iframe id="videoFrame" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>
    <div class="splitter-horizontal" id="splitH"></div>
    <div id="timerArea" class="work">
      <div id="modeLabel">ä½œæ¥­æ™‚é–“</div>
      <select id="cycleSelect" style="margin:0 8px;">
        <option value="25-5">25åˆ†ä½œæ¥­ï¼5åˆ†ä¼‘æ†©</option>
        <option value="50-10">50åˆ†ä½œæ¥­ï¼10åˆ†ä¼‘æ†©</option>
        <option value="45-5">45åˆ†ä½œæ¥­ï¼5åˆ†ä¼‘æ†©</option>
        <option value="90-10">90åˆ†ä½œæ¥­ï¼10åˆ†ä¼‘æ†©</option>
        <option value="52-17">52åˆ†ä½œæ¥­ï¼17åˆ†ä¼‘æ†©</option>
        <option value="12-3">12åˆ†ä½œæ¥­ï¼3åˆ†ä¼‘æ†©</option>
        <option value="5-1">5åˆ†ä½œæ¥­ï¼1åˆ†ä¼‘æ†©</option>
      </select>
      <div id="startupPopup" style="display:none; position:absolute; left:50%; transform:translateX(-50%); background:rgba(200,0,0,0.7); color:white; padding: 0.5em; z-index:30;">
        æ•°å­—ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚¹ã‚¿ãƒ¼ãƒˆï¼
      </div>
      <div id="timerDisplay" title="ã‚¯ãƒªãƒƒã‚¯ã§ä¸€æ™‚åœæ­¢ï¼å†é–‹">00:00</div>
      <input type="range" id="timerSlider" min="0" max="1500" value="1500">
      <!-- éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
      <div class="volumeControl" title="ãƒ™ãƒ«éŸ³é‡">
	<span id="volIcon">ğŸ”ˆ</span>
	<input type="range" id="chimeVolume" min="0" max="100" step="5" value="50">
	<span id="volLabel">50%</span>
      </div>
    </div>
  </div>
</div>
<button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
<script>
  //// ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼è¨­å®š

  // å·¦å³åˆ†å‰²
  const container = document.getElementById('container');
  const splitV = document.getElementById('splitV');
  let isDraggingV = false;
  splitV.addEventListener('mousedown', () => {
      isDraggingV = true;
      document.body.style.cursor = 'col-resize';
      document.getElementById('videoFrame').style.pointerEvents = 'none';
  });
  document.addEventListener('mousemove', e => {
      if (!isDraggingV) return;
      const total = container.clientWidth;
      const w1 = e.clientX;
      const w3 = total - w1 - splitV.clientWidth;
      if (w1 >= 0 && w3 > 100) container.style.gridTemplateColumns = `${w1}px 5px ${w3}px`;
  });
  document.addEventListener('mouseup', () => {
      isDraggingV = false;
      document.body.style.cursor = '';
      localStorage.setItem('splitCols', container.style.gridTemplateColumns);
      document.getElementById('videoFrame').style.pointerEvents = 'auto';
  });
  // ä¸Šä¸‹åˆ†å‰²
  const rightGrid = document.getElementById('rightGrid');
  const splitH = document.getElementById('splitH');
  let isDraggingH = false;
  splitH.addEventListener('mousedown', () => {
      isDraggingH = true;
      document.body.style.cursor = 'row-resize';
      document.getElementById('videoFrame').style.pointerEvents = 'none';
  });
  document.addEventListener('mousemove', e => {
      if (!isDraggingH) return;
      const rect = rightGrid.getBoundingClientRect();
      const h1 = e.clientY - rect.top;
      const h3 = rect.height - h1 - splitH.clientHeight;
      if (h1 >= 0 && h3 >= 0) rightGrid.style.gridTemplateRows = `${h1}px 5px ${h3}px`;
  });
  document.addEventListener('mouseup', () => {
      isDraggingH = false;
      document.body.style.cursor = '';
      localStorage.setItem('splitRows', rightGrid.style.gridTemplateRows);
      document.getElementById('videoFrame').style.pointerEvents = 'auto';
  });
  // å¾©å…ƒ
  window.addEventListener('DOMContentLoaded', () => {
      // ä¿å­˜æ¸ˆã¿ã®åˆ—å¹…ã‚’å¾©å…ƒ
      const savedCols = localStorage.getItem('splitCols');
      if (savedCols) container.style.gridTemplateColumns = savedCols;
      // ä¿å­˜æ¸ˆã¿ã®è¡Œé«˜ã‚’å¾©å…ƒ
      const savedRows = localStorage.getItem('splitRows');
      if (savedRows) rightGrid.style.gridTemplateRows = savedRows;
  });


  //// è‡ªç”±è¨˜è¿°ã‚¨ãƒªã‚¢

  // contentEditable & toolbar
  document.execCommand('styleWithCSS', false, true);
  const editable = document.getElementById('editableContent');
  const toolbar = document.getElementById('toolbar');
  editable.addEventListener('dblclick', () => {
      editable.contentEditable = 'true';
      toolbar.style.display = 'flex';
      editable.style.backgroundColor = '#f0d0d0';
  });
  toolbar.addEventListener('click', e => {
      e.preventDefault();
      const cmd = e.target.getAttribute('data-cmd');
      if (!cmd) return;
      if (cmd.startsWith('formatH')) document.execCommand('formatBlock', false, cmd.replace('format',''));
      else document.execCommand(cmd, false, null);
  });
  // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’é¸ã‚“ã ç¬é–“ã«é©ç”¨
  document.getElementById('fontSizeSelect').addEventListener('change', e => {
      const size = e.target.value + 'px';
      document.execCommand('fontSize', false, size);
  });
  // HTML ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
  document.getElementById('copyHtmlBtn').addEventListener('click', e => {
    e.preventDefault();
    const html = editable.innerHTML;
    navigator.clipboard.writeText(html)
      .then(() => alert('HTML ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'))
      .catch(() => alert('ã‚³ãƒ”ãƒ¼å¤±æ•—'));
  });
  // HTML ãƒšãƒ¼ã‚¹ãƒˆæ©Ÿèƒ½
  document.getElementById('pasteHtmlBtn').addEventListener('click', e => {
    e.preventDefault();
    const userHtml = prompt('è²¼ã‚Šä»˜ã‘ãŸã„HTMLã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    if (userHtml) {
      document.execCommand('insertHTML', false, userHtml);
    }
  });
  // è‡ªå‹•ä¿å­˜ãƒ»å¾©å…ƒ
  window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('freeContent');
      if (saved) editable.innerHTML = saved;
  });
  // ç”»åƒé¸æŠ
  let selectedImg = null;
  editable.addEventListener('click', e => {
      // ä»–ã®é¸æŠç”»åƒã®é¸æŠè§£é™¤
      document.querySelectorAll('#editableContent img').forEach(img => img.classList.remove('selected'));
      // é¸æŠç”»åƒ
      if (e.target.tagName === 'IMG' && editable.contentEditable == 'true') {
          selectedImg = e.target;
          selectedImg.classList.add('selected');
      } else {
          selectedImg = null;
      }
  });
  // ç”»åƒã‚µã‚¤ã‚ºå¤‰æ›´
  document.getElementById('imgZoomInBtn').addEventListener('click', e => zoomImg(1.25));
  document.getElementById('imgZoomOutBtn').addEventListener('click', e => zoomImg(0.8));
  function zoomImg(rate) {
      if (selectedImg) selectedImg.style.width = Math.round(selectedImg.width * rate) + 'px';
      else alert('ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„');
  }
  // ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
  document.getElementById('closeToolbar').addEventListener('click', () => {
      toolbar.style.display = 'none';
      editable.contentEditable = 'false';
      editable.style.backgroundColor = 'white';
      document.querySelectorAll('#editableContent img').forEach(img => img.classList.remove('selected'));
      localStorage.setItem('freeContent', editable.innerHTML);
  });


  //// YouTubeã‚¨ãƒªã‚¢

  let workVideoId = 'jfKfPfyJRdk'; // åˆæœŸå‹•ç”»ID
  //let breakVideoId = 'xxpg9_2on3I'; // åˆæœŸå‹•ç”»ID
  let breakVideoId = 'Yb-rLsCpBvI'; // åˆæœŸå‹•ç”»ID

  // YouTube embed
  document.getElementById('workVideoForm').addEventListener('submit', e => {
      workVideoId = setVideo(e, 'work');
      if (workVideoId) localStorage.setItem('workVideoId', workVideoId);
  });
  document.getElementById('breakVideoForm').addEventListener('submit', e => {
      breakVideoId = setVideo(e, 'break');
      if (breakVideoId) localStorage.setItem('breakVideoId', breakVideoId);
  });
  function setVideo(e, vtype) {
      e.preventDefault();
      let url = document.getElementById(vtype + 'VideoURL').value.trim();
      if (!url) return;
      let id = '';
      try {
          const u = new URL(url);
          id = u.hostname.includes('youtu.be') ? u.pathname.slice(1) : u.searchParams.get('v');
      } catch {
          const m = url.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
          if (m) id = m[1];
      }
      if (id) document.getElementById('videoFrame').src = `https://www.youtube.com/embed/${id}?enablejsapi=1`;
      return id;
  };

  const tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  const firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  let player;
  function onYouTubeIframeAPIReady() {
      player = new YT.Player('videoFrame', {
          videoId: workVideoId,
          playerVars: { enablejsapi: 1 },
          events: { 'onStateChange': onPlayerStateChange }
      });
  };

  function onPlayerStateChange(event) {
      // çµ‚äº†çŠ¶æ…‹ï¼ˆENDEDï¼‰ã®æ™‚ã ã‘å†ç”Ÿ
      if (event.data === YT.PlayerState.ENDED) event.target.playVideo();
  }


  //// ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ã‚¨ãƒªã‚¢

  // Pomodoro Timer
  const work = 25*60;
  const br = 5*60;
  let workDuration = 25*60;
  let breakDuration = 5*60;
  let cur = workDuration;
  let rem = cur;
  let isWork = true;
  let paused = true;
  let beforeStart = true;
  const modeLabel = document.getElementById('modeLabel');
  const cycle = document.getElementById('cycleSelect');
  const disp = document.getElementById('timerDisplay');
  const slider = document.getElementById('timerSlider');
  // ãƒ•ã‚©ãƒ³ãƒˆè‡ªå‹•èª¿æ•´
  const resizeObs = new ResizeObserver(entries => {
      window.requestAnimationFrame(() => {
          for (const entry of entries) {
              const { width, height } = entry.contentRect;
              // ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚ºã‚’è¨ˆç®—
              const rawMode = Math.min(Math.floor(height * 0.20), Math.floor(width * 0.15));
              const rawCycle = Math.min(Math.floor(height * 0.13), Math.floor(width * 0.10));
              const rawDisp = Math.min(Math.floor(height * 0.5), Math.floor(width * 0.4));
              // ã‚µã‚¤ã‚ºèª¿æ•´
              const modeSize = Math.max(10, Math.floor(rawMode * 0.5));
              const cycleSize = Math.max(8, Math.floor(rawCycle * 0.5));
              const dispSize = Math.max(12, Math.floor(rawDisp * 0.5));
              modeLabel.style.fontSize = modeSize + 'px';
              cycle.style.fontSize = cycleSize + 'px';
              disp.style.fontSize = dispSize + 'px';
          }
      });
  });
  resizeObs.observe(document.getElementById('timerArea'));
  slider.max = cur;
  slider.value = rem;
  slider.addEventListener('input', () => {
      rem =+ slider.value;
      update();
  });
  disp.addEventListener('click', ev => {
      paused = !paused;
      ev.target.style.color = paused ? '#aaa' : '#333';
  });
  cycle.addEventListener('change', e => {
      localStorage.setItem('cycleSelect', e.target.value);
      const [w, b] = e.target.value.split('-').map(v => parseInt(v, 10));
      workDuration  = w * 60;
      breakDuration = b * 60;
      // ç¾åœ¨ã®ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦ãƒªã‚»ãƒƒãƒˆ
      cur = isWork ? workDuration : breakDuration;
      rem = cur;
      slider.max = cur;
      update();
  });
  // ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
  function update() {
      const m = String(Math.floor(rem / 60)).padStart(2, '0');
      const s = String(rem % 60).padStart(2, '0');
      disp.textContent = `${m}:${s}`;
      slider.value = rem;
  }

  // éŸ³é‡ç”¨ã®å¤‰æ•°
  document.chimeVolume = 50; // 0-100
  // ãƒãƒ£ã‚¤ãƒ ã‚’é³´ã‚‰ã™
  function chime(){
      const c = new (AudioContext||webkitAudioContext)();
      const o = c.createOscillator();
      const g = c.createGain();
      o.connect(g);
      g.connect(c.destination);
      g.gain.setValueAtTime(document.chimeVolume/100, c.currentTime); // ãƒœãƒªãƒ¥ãƒ¼ãƒ è¨­å®šã‚’åæ˜ 
      //g.gain.setValueAtTime(1, c.currentTime);
      const chimeDuration = 3;  // ãƒãƒ£ã‚¤ãƒ ã‚’Nç§’é–“é³´ã‚‰ã™
      g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + chimeDuration);
      o.frequency.setValueAtTime(1000, c.currentTime);
      o.start(c.currentTime);
      o.stop(c.currentTime + chimeDuration);
  }

  // 1ç§’ã”ã¨ã®ç¢ºèªäº‹é …
  function tick() {
      if (paused) return;
      if (beforeStart) { // ä¸€ç•ªæœ€åˆã®ã‚¹ã‚¿ãƒ¼ãƒˆæ™‚
          beforeStart = false;
          isWork = false;
          rem = 0;
      }
      if (rem > 0) {
          rem--;
      } else {
          chime();
          isWork = !isWork;
          // åˆ‡ã‚Šæ›¿ãˆ
          const timerArea = document.getElementById('timerArea');
          if (isWork) {
              timerArea.classList.add('work');
              timerArea.classList.remove('break');
              player.loadVideoById(workVideoId);
          } else {
              timerArea.classList.add('break');
              timerArea.classList.remove('work');
              player.loadVideoById(breakVideoId);
          }
          player.playVideo();
          // ãƒ©ãƒ™ãƒ«ãƒ»ã‚¿ã‚¤ãƒãƒ¼å†è¨­å®š
          cur = isWork ? workDuration : breakDuration;
          rem = cur;
          slider.max = cur;
          modeLabel.textContent = isWork ? 'ä½œæ¥­æ™‚é–“' : 'ä¼‘æ†©æ™‚é–“';
      }
      update();
  }
  // ä¸€ç•ªæœ€åˆã«ã‚„ã‚‹ã“ã¨
  //chime();
  update();
  setInterval(tick, 1000);

  //// èª­ã¿è¾¼ã¿ç›´å¾Œã®å‡¦ç†
  window.addEventListener('DOMContentLoaded', () => {
      const wvi = localStorage.getItem('workVideoId');
      const bvi = localStorage.getItem('breakVideoId');
      if (wvi) workVideoId = wvi;
      if (bvi) breakVideoId = bvi;
      console.log(bvi,breakVideoId);
      document.getElementById('breakVideoURL').value = `https://www.youtube.com/watch?v=${breakVideoId}`;
      document.getElementById('workVideoURL').value = `https://www.youtube.com/watch?v=${workVideoId}`;
      document.getElementById('videoFrame').src  = `https://www.youtube.com/embed/${workVideoId}?enablejsapi=1`;

      const cycleSelect = document.getElementById('cycleSelect');
      const saved = localStorage.getItem('cycleSelect');
      if (saved) {
          cycleSelect.value = saved;
          // value ã‚’ã‚»ãƒƒãƒˆã—ãŸå¾Œã€è¨­å®šé©ç”¨ã®ãŸã‚ã« change ã‚’ãƒˆãƒªã‚¬ãƒ¼
          cycleSelect.dispatchEvent(new Event('change'));
      };

      const popup = document.getElementById('startupPopup');
      popup.style.display = 'block';  // è¡¨ç¤º
      setTimeout(() => { popup.style.display = 'none' }, 3000); // Nç§’å¾Œã«éè¡¨ç¤º

      // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ï¼šãƒ›ãƒãƒ¼ã§è¡¨ç¤ºï¼ã‚¯ãƒªãƒƒã‚¯ã§ confirmâ†’ã‚¯ãƒªã‚¢â†’ãƒªãƒ­ãƒ¼ãƒ‰
      const resetBtn = document.getElementById('resetBtn');
      // ãƒã‚¦ã‚¹ãŒå³ä¸‹ã«æ¥ãŸã‚‰è¡¨ç¤º
      document.addEventListener('mousemove', e => {
	  const { clientX, clientY } = e;
	  const w = window.innerWidth, h = window.innerHeight;
	  if (clientX > w - 100 && clientY > h - 60) resetBtn.style.display = 'block';
	  else resetBtn.style.display = 'none';
      });
      resetBtn.addEventListener('click', () => {
	  if (confirm('æœ¬å½“ã«åˆæœŸçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
	      localStorage.clear();
	      location.reload();
	  }
      });

      const sliderVol = document.getElementById('chimeVolume');
      const icon      = document.getElementById('volIcon');
      const label     = document.getElementById('volLabel');
      // ä¿å­˜æ¸ˆã¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰
      const savedVol = localStorage.getItem('chimeVolume');
      if (savedVol !== null) {
	  sliderVol.value = savedVol;
	  document.chimeVolume = parseInt(savedVol, 10);
	  label.textContent = savedVol + '%';
	  icon.textContent = (savedVol == 0 ? 'ğŸ”‡' : savedVol < 50 ? 'ğŸ”ˆ' : 'ğŸ”Š');
      }
      // ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
      sliderVol.addEventListener('input', e => {
	  const v = e.target.value;
	  localStorage.setItem('chimeVolume', v); // å¤‰æ›´ã‚’ä¿å­˜
	  document.chimeVolume = v;
	  label.textContent = v + '%';
	  icon.textContent = v == 0 ? 'ğŸ”‡' : v < 50 ? 'ğŸ”ˆ' : 'ğŸ”Š';
	  chime();
      });
  });

</script>

</body>
<!--
ä½œè€…: ã‚¿ãƒ„ãƒ²
https://x.com/yto
-->
</html>
